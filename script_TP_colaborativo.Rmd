---
title: "R Notebook"
output: html_notebook
---


```{r}
library(corrplot)
library(ggplot2)
library(tidyverse)
library(readxl)
library(mongolite)
library(sqldf)
```

```{r}
#dir igal
df_artist <- read.csv("C:/Users/igalk/OneDrive/Documentos/laburo/Data Mining FCEyN/Data mining/TP/data_mining/data/df_artist_sin_duplicados.csv")

df_charts <- read.csv("C:/Users/igalk/OneDrive/Documentos/laburo/Data Mining FCEyN/Data mining/TP/data_mining/data/df_charts_sin_duplicados.csv")

df_audio_features <- read.csv("C:/Users/igalk/OneDrive/Documentos/laburo/Data Mining FCEyN/Data mining/TP/audio_features_plano_sin_duplicados.csv")

#dir Nacho
#df_artist <- read.csv()

#df_charts <- read.csv()

#df_audio_features <- read.csv()

#dir Mateo
df_artist <- read.csv("data/df_artist_sin_duplicados.csv")

df_charts <- read.csv("data/df_charts_sin_duplicados.csv")

df_audio_features <- read.csv("data/audio_features_plano_sin_duplicados.csv")

head(df_charts)

```


```{r}

#features var_ continuos
features <- c('acousticness', 'danceability', 'duration_ms', 'energy', 'instrumentalness', 'liveness', 'loudness', 'speechiness',   'tempo', 'valence')


summary(df_audio_features[, features])

for (i in features){
  hist(df_audio_features[, i], main= i)

}

x <- cor(df_audio_features[,features])
corrplot(x, type = "upper")

```


```{r}
#Agregar a los artistas y clacular la varianza de los features entre sus temas
for (i in features){

  z <- aggregate(df_audio_features[, i], by= list(df_audio_features$artist_name), FUN= var)
  k<- mean(z[,2], na.rm = TRUE) #algo pasa que tira algunos NA. revisar! (y no hay NA en las filas)
  J <- median(z[,2], na.rm = TRUE) 

  hist(z[,2], main = paste("Histograma de varianza de", i, "(agrupados por artista)"))
  abline(v = k , col="red")
  abline(v = J , col="blue")

}


#Agregar a los album y clacular la varianza de los features entre sus temas

for (i in features){

  z <- aggregate(df_audio_features[, i], by= list(df_audio_features$album_name), FUN= var)
  k<- mean(z[,2], na.rm = TRUE)
  J <- median(z[,2], na.rm = TRUE) 

  hist(z[,2], main = paste("Histograma de varianza de", i, "(agrupados por album)"))
  abline(v = k , col="red")
  abline(v = J , col="blue")

}


for (i in features){

  z <- aggregate(df_audio_features[, i], by= list(df_audio_features$album_release_year), FUN= var)
  k<- mean(z[,2], na.rm = TRUE)
  J <- median(z[,2], na.rm = TRUE) 

  hist(z[,2], main = paste("Histograma de varianza de", i, "(agrupados por año de lanzamiento)"))
  abline(v = k , col="red")
  abline(v = J , col="blue")

}


boxplot(scale(df_audio_features[,features]), ylim=c(-5,5), las=3)


```

# Analisis de outliers

##histograma de las variables
```{r}
for (i in features){

  hist(df_audio_features[,i], main = paste("Histograma de", i), xlab = i)
  abline(v = mean(df_audio_features[,i], na.rm = TRUE) , col="red")
  abline(v = median(df_audio_features[,i], na.rm = TRUE) , col="blue")

}
```


## Metricas de variacion
```{r}
#coeficiente de variacion
cat("coeficiente de variacion\n")
cv <- round(apply(df_audio_features[,features], 2, statip::cv, na_rm = T),2)
cv[order(names(cv))]

cat("\ndesvio_standard\n")
desvio_standard <- round(apply(df_audio_features[,features], 2, sd),2)
desvio_standard[order(names(desvio_standard))]

```


Normalizo los datos con z-score para que sean comparables y los guardo en un nuevo DF

```{r}

df_audio_features_num <- df_audio_features[,features]

for(i in 1:ncol(df_audio_features_num)){
  df_audio_features_num[, i] <- (df_audio_features_num[,i] -
                                   mean(df_audio_features_num[,i]))/(sd(df_audio_features_num[,i])) }

# Configuramos el tamaño del lienzo (ver "par" del paquete graphics)
par(mfrow=c(1, 1), mar=c(5, 12, 4, 2) ) 

# Y graficamos un solo boxplot con todas las medidas
boxplot(df_audio_features[,features],horizontal = TRUE, las=1, xlab="z-score")
stripchart(data[,c(3:8)], vertical = FALSE ,
    method = "jitter", add = TRUE, pch = 20, col = 'blue')
```
Hay 149,539 temas unicos que superan el bigote superior del boxplot de duration_ms (1.5 veces el RI)
```{r}

duration.bigote.superior <- boxplot(df_audio_features_num$duration_ms)$stats[5]
duration.bigote.inferior <- boxplot(df_audio_features_num$duration_ms)$stats[1]

length(unique(df_audio_features["track_id"][(df_audio_features$duration_ms > duration.bigote.superior | 
                                               df_audio_features$duration_ms < duration.bigote.inferior),]))

length(df_audio_features["track_id"][(df_audio_features$duration_ms > duration.bigote.superior | 
                                               df_audio_features$duration_ms < duration.bigote.inferior),])


length(unique(df_audio_features["artist_name"][df_audio_features$duration_ms < duration.bigote.inferior,]))
```
```{r}
#analisis de z score
umbral_zscore =3
df_audio_features[df_audio_features_num$speechiness> umbral_zscore,] %>% 
  select(album_name,artist_name, speechiness ) %>% 
  arrange(-speechiness)

```


<<<<<<< HEAD
=======
```{r}

#espacio de nacho


```





```{r}
#espacio de igal





```









>>>>>>> 6b28e5e79f4ba92ff9a5a8224a77530a90857d00
